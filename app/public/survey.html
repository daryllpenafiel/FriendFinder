<!doctype HTML>
<html>

<head>
    <title>Survey</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Tajawal:300" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Dancing+Script" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">

</head>

<body>
    <div class="container">

        <div class="surveyquestions">
            <br>
            <div class="form-group">
                <label for="personName">Name:</label>
                <input type="text" class="form-control" id="personName">
            </div><br>

            <div class="form-group">
                <label for="url">Enter an image URL (https please):</label>
                <input type="url" class="form-control" name="url" id="imgUrl" placeholder="https://example.com" pattern="https://.*" size="200"
                    required />
            </div>

            <br>
            <h1 class="intro">How much do you love (or hate) the following things?</h1>
            <br>

            <div class="form-group">
                <p> 1. The Great Outdoors </p>
                <label class="radio-inline">
                    <input type="radio" name="q1" value="1">1 (Hate it!)</label>
                <label class="radio-inline">
                    <input type="radio" name="q1" value="2">2</label>
                <label class="radio-inline">
                    <input type="radio" name="q1" value="3">3</label>
                <label class="radio-inline">
                    <input type="radio" name="q1" value="4">4</label>
                <label class="radio-inline">
                    <input type="radio" name="q1" value="5">5 (Love it!)</label>
            </div>
            <br>

            <div class="form-group">
                <p> 2. Pizza and Beer </p>
                <label class="radio-inline">
                    <input type="radio" name="q2" value="1">1 (Hate it!)</label>
                <label class="radio-inline">
                    <input type="radio" name="q2" value="2">2</label>
                <label class="radio-inline">
                    <input type="radio" name="q2" value="3">3</label>
                <label class="radio-inline">
                    <input type="radio" name="q2" value="4">4</label>
                <label class="radio-inline">
                    <input type="radio" name="q2" value="5">5 (Love it!)</label>
            </div>
            <br>

            <div class="form-group">
                <p> 3. Long walks on the beach </p>
                <label class="radio-inline">
                    <input type="radio" name="q3" value="1">1 (Hate it!)</label>
                <label class="radio-inline">
                    <input type="radio" name="q3" value="2">2</label>
                <label class="radio-inline">
                    <input type="radio" name="q3" value="3">3</label>
                <label class="radio-inline">
                    <input type="radio" name="q3" value="4">4</label>
                <label class="radio-inline">
                    <input type="radio" name="q3" value="5">5 (Love it!)</label>
            </div>
            <br>

            <div class="form-group">
                <p> 4. Pets </p>
                <label class="radio-inline">
                    <input type="radio" name="q4" value="1">1 (Hate it!)</label>
                <label class="radio-inline">
                    <input type="radio" name="q4" value="2">2</label>
                <label class="radio-inline">
                    <input type="radio" name="q4" value="3">3</label>
                <label class="radio-inline">
                    <input type="radio" name="q4" value="4">4</label>
                <label class="radio-inline">
                    <input type="radio" name="q4" value="5">5 (Love it!)</label>
            </div>
            <br>

            <div class="form-group">
                <p> 5. Netflix </p>
                <label class="radio-inline">
                    <input type="radio" name="q5" value="1">1 (Hate it!)</label>
                <label class="radio-inline">
                    <input type="radio" name="q5" value="2">2</label>
                <label class="radio-inline">
                    <input type="radio" name="q5" value="3">3</label>
                <label class="radio-inline">
                    <input type="radio" name="q5" value="4">4</label>
                <label class="radio-inline">
                    <input type="radio" name="q5" value="5">5 (Love it!)</label>
            </div>
            <br>

            <div class="form-group">
                <p> 6. Cheech and Chong </p>
                <label class="radio-inline">
                    <input type="radio" name="q6" value="1">1 (Hate it!)</label>
                <label class="radio-inline">
                    <input type="radio" name="q6" value="2">2</label>
                <label class="radio-inline">
                    <input type="radio" name="q6" value="3">3</label>
                <label class="radio-inline">
                    <input type="radio" name="q6" value="4">4</label>
                <label class="radio-inline">
                    <input type="radio" name="q6" value="5">5 (Love it!)</label>
            </div>
            <br>

            <div class="form-group">
                <p> 7. Sushi </p>
                <label class="radio-inline">
                    <input type="radio" name="q7" value="1">1 (Hate it!)</label>
                <label class="radio-inline">
                    <input type="radio" name="q7" value="2">2</label>
                <label class="radio-inline">
                    <input type="radio" name="q7" value="3">3</label>
                <label class="radio-inline">
                    <input type="radio" name="q7" value="4">4</label>
                <label class="radio-inline">
                    <input type="radio" name="q7" value="5">5 (Love it!)</label>
            </div>
            <br>

            <div class="form-group">
                <p> 8. Memes </p>
                <label class="radio-inline">
                    <input type="radio" name="q8" value="1">1 (Hate it!)</label>
                <label class="radio-inline">
                    <input type="radio" name="q8" value="2">2</label>
                <label class="radio-inline">
                    <input type="radio" name="q8" value="3">3</label>
                <label class="radio-inline">
                    <input type="radio" name="q8" value="4">4</label>
                <label class="radio-inline">
                    <input type="radio" name="q8" value="5">5 (Love it!)</label>
            </div>
            <br>

            <div class="form-group">
                <p> 9. Political Discussions </p>
                <label class="radio-inline">
                    <input type="radio" name="q9" value="1">1 (Hate it!)</label>
                <label class="radio-inline">
                    <input type="radio" name="q9" value="2">2</label>
                <label class="radio-inline">
                    <input type="radio" name="q9" value="3">3</label>
                <label class="radio-inline">
                    <input type="radio" name="q9" value="4">4</label>
                <label class="radio-inline">
                    <input type="radio" name="q9" value="5">5 (Love it!)</label>
            </div>
            <br>

            <div class="form-group">
                <p> 10. Recycling </p>
                <label class="radio-inline">
                    <input type="radio" name="q10" value="1">1 (Hate it!)</label>
                <label class="radio-inline">
                    <input type="radio" name="q10" value="2">2</label>
                <label class="radio-inline">
                    <input type="radio" name="q10" value="3">3</label>
                <label class="radio-inline">
                    <input type="radio" name="q10" value="4">4</label>
                <label class="radio-inline">
                    <input type="radio" name="q10" value="5">5 (Love it!)</label>
            </div>
            <br>

            <div id="submitbutton">
                <input class="btn btn-primary" value="Submit">
            </div>
            <br>

        </div>

        <div class="resultbox">
            <p class="result">Your match is
                <span id="matchName"> </span>
            </p>
            <p class="result">
                <img id="matchImage">
            </p>
            <br>
            <div class="resetbutton">
                <input class="btn btn-primary" value="Try Again" id="tryAgain">
            </div>
            <br>
        </div>

        <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
        <script>
            $(document).ready(function () {


                $(".resultbox").hide();

                $("#submitbutton").on("click", function () {
                    checkAnswers();
                });

                $("#tryAgain").on("click", function () {
                    window.location.href='./';
                });

                var answersArray = [];

                function checkAnswers() {
                    var friendName = $("#personName").val();
                    var friendImage = $("#imgUrl").val();
                    var q1answer = $("input[type=radio][name=q1]:checked").val();
                    var q2answer = $("input[type=radio][name=q2]:checked").val();
                    var q3answer = $("input[type=radio][name=q3]:checked").val();
                    var q4answer = $("input[type=radio][name=q4]:checked").val();
                    var q5answer = $("input[type=radio][name=q5]:checked").val();
                    var q6answer = $("input[type=radio][name=q6]:checked").val();
                    var q7answer = $("input[type=radio][name=q7]:checked").val();
                    var q8answer = $("input[type=radio][name=q8]:checked").val();
                    var q9answer = $("input[type=radio][name=q9]:checked").val();
                    var q10answer = $("input[type=radio][name=q10]:checked").val();

                    if (!friendName || !friendImage || !q1answer || !q2answer || !q3answer || !q4answer || !
                        q5answer || !q6answer || !q7answer || !q8answer || !q9answer || !q10answer) {
                        alert("Please answer all fields and questions.");
                    } else {
                        answersArray.push(q1answer, q2answer, q3answer, q4answer, q5answer,
                            q6answer, q7answer, q8answer, q9answer, q10answer);
                    };

                    var newFriend = {
                        "name": friendName,
                        "photo": friendImage,
                        "scores": answersArray
                    };

                    console.log(newFriend);


                    //-----------------------------------------------------------------------
                    function compareFriends() {

                        var currentURL = window.location.origin;

                        $.ajax({
                                url: currentURL + "/api/friends",
                                method: "GET"
                            })
                            .then(function (friendsData) {
                                var computedObjects = [];

                                for (var i = 0; i < friendsData.length; i++) {
                                    var arr1 = newFriend.scores;
                                    var arr2 = friendsData[i].scores;
                                    var arr3 = [];

                                    for (let i = 0; i < arr1.length; i++) {
                                        arr3.push(Math.abs(arr1[i] - arr2[i]));
                                    }

                                    var totalDifference = arr3.reduce(function (a, b) {
                                        return a + b;
                                    }, 0);

                                    tmp = {
                                        'name': friendsData[i].name,
                                        'image': friendsData[i].photo,
                                        'difference': totalDifference
                                    }

                                    computedObjects.push(tmp);
                                }

                                console.log(computedObjects);

                                //look for minimum difference in objects
                                var res = Math.min.apply(Math, computedObjects.map(function (o) {
                                    return o.difference;
                                }))

                                var obj = computedObjects.find(function (o) {
                                    return o.difference == res;
                                })

                                console.log(obj);

                                $("#matchName").text(obj.name);
                                $("#matchImage").attr("src", obj.image);

                                $(".resultbox").show();
                                $(".surveyquestions").hide();

                            })
                        $.post("/api/friends", newFriend, function (data) {

                            console.log("New friend added to JSON");

                        });
                    };

                    compareFriends();

                }

            });
        </script>
</body>

</html>